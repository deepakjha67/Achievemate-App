<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#0f172a">
    <title>Achieve-mate</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* --- CORE STYLES --- */
        :root {
            --bg-body: #0f172a;
            --bg-card: #1e293b;
            --bg-card-hover: #334155;
            --bg-sidebar: #0f172a; 
            
            --primary: #6366f1;
            --primary-hover: #4f46e5;
            --accent: #fbbf24;
            --success: #10b981;
            --danger: #ef4444;
            
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
            --border: #334155;
            
            --radius-lg: 16px;
            --radius-md: 12px;
            
            --font-main: 'Inter', sans-serif;
            --font-heading: 'Poppins', sans-serif;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; scrollbar-width: thin; scrollbar-color: var(--border) var(--bg-body); }
        
        body { 
            background-color: var(--bg-body); 
            color: var(--text-main); 
            font-family: var(--font-main); 
            line-height: 1.6; 
            overflow-x: hidden;
            overscroll-behavior-y: none; 
        }

        .app-wrapper { display: flex; min-height: 100vh; min-height: 100dvh; }

        /* Sidebar */
        .sidebar { width: 260px; background: var(--bg-sidebar); border-right: 1px solid var(--border); display: flex; flex-direction: column; padding: 1.5rem; position: fixed; height: 100vh; height: 100dvh; z-index: 50; transition: transform 0.3s ease; }
        .brand { display: flex; align-items: center; gap: 0.75rem; margin-bottom: 2.5rem; color: var(--primary); font-family: var(--font-heading); font-weight: 700; font-size: 1.25rem; }
        
        .nav-item { display: flex; align-items: center; gap: 1rem; padding: 0.875rem 1rem; border-radius: var(--radius-md); color: var(--text-muted); cursor: pointer; transition: all 0.2s ease; font-weight: 500; margin-bottom: 0.5rem; border-left: 3px solid transparent; }
        .nav-item:hover { background: var(--bg-card-hover); color: var(--text-main); }
        .nav-item.active { background: rgba(99, 102, 241, 0.1); color: var(--primary); border-left-color: var(--primary); box-shadow: 0 0 15px rgba(99, 102, 241, 0.1); }

        .sidebar-footer { margin-top: auto; padding-top: 1.5rem; border-top: 1px solid var(--border); text-align: center; font-size: 0.8rem; color: var(--text-muted); }
        .creator-link { color: var(--accent); text-decoration: none; font-weight: 600; display: inline-flex; align-items: center; gap: 5px; margin-top: 5px; transition: color 0.2s; }
        .creator-link:hover { color: var(--primary); }

        /* Main Content */
        .main-content { flex: 1; margin-left: 260px; padding: 2rem; max-width: 1600px; padding-bottom: 120px; }

        /* Mobile Nav */
        .mobile-nav { display: none; position: fixed; bottom: 0; left: 0; width: 100%; background: var(--bg-card); border-top: 1px solid var(--border); padding: 0 1rem; justify-content: space-around; z-index: 100; padding-bottom: env(safe-area-inset-bottom); height: 70px; align-items: center; }
        .mobile-nav-item { display: flex; flex-direction: column; align-items: center; gap: 4px; color: var(--text-muted); font-size: 0.7rem; padding: 8px 16px; cursor: pointer; transition: all 0.2s; border-radius: 12px; position: relative; }
        .mobile-nav-item i { font-size: 1.3rem; margin-bottom: 2px; transition: transform 0.2s; }
        .mobile-nav-item.active { color: #fff; }
        .mobile-nav-item.active i { color: var(--primary); transform: translateY(-2px); }
        .mobile-nav-item.active::after { content: ''; position: absolute; top: -10px; left: 50%; transform: translateX(-50%); width: 20px; height: 4px; background: var(--primary); border-radius: 0 0 4px 4px; box-shadow: 0 0 10px var(--primary); }

        /* Header */
        .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; }
        .header-right { display: flex; align-items: center; gap: 15px; }
        .greeting h1 { font-family: var(--font-heading); font-size: 1.75rem; font-weight: 600; line-height: 1.2; }
        
        .streak-badge { display: flex; align-items: center; gap: 0.75rem; background: rgba(251, 191, 36, 0.1); border: 1px solid rgba(251, 191, 36, 0.2); padding: 0.5rem 1rem; border-radius: 50px; cursor: pointer; transition: transform 0.2s; white-space: nowrap; height: fit-content; }
        .streak-count { font-weight: 700; color: var(--accent); font-size: 1.1rem; }
        
        .header-login-btn { background: var(--primary); color: white; padding: 0.5rem 1.2rem; border-radius: 20px; font-size: 0.9rem; font-weight: 600; border: none; cursor: pointer; display: flex; align-items: center; gap: 8px; box-shadow: 0 4px 10px rgba(99, 102, 241, 0.3); transition: transform 0.2s; }
        .header-login-btn:hover { transform: translateY(-2px); background: var(--primary-hover); }

        /* NEW LOGGED IN BADGE (Minimal) */
        .user-badge-header { display:none; align-items:center; gap:10px; cursor:pointer; }
        .user-badge-avatar { width: 36px; height: 36px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; color: white; border: 2px solid var(--bg-card); box-shadow: 0 0 0 1px var(--border); }
        .user-badge-name { display: none; } 

        /* Components */
        .card { background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius-lg); padding: 1.5rem; margin-bottom: 1.5rem; }
        
        .card-title { font-family: var(--font-heading); font-size: 1.1rem; font-weight: 600; margin-bottom: 1.25rem; display: flex; align-items: center; justify-content: space-between; color: var(--text-main); }
        .card-title-group { display: flex; align-items: center; gap: 10px; }
        
        .btn { border: none; outline: none; cursor: pointer; font-family: var(--font-main); font-weight: 500; border-radius: var(--radius-md); padding: 0.75rem 1.5rem; transition: all 0.2s; display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem; font-size: 0.95rem; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-secondary { background: var(--bg-card-hover); color: var(--text-main); border: 1px solid var(--border); }
        .btn-danger { background: rgba(239, 68, 68, 0.1); color: var(--danger); border: 1px solid rgba(239, 68, 68, 0.2); }
        .btn-sm { padding: 0.4rem 0.8rem; font-size: 0.8rem; }
        .btn-icon-only { padding: 0.5rem; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--text-muted); background: transparent; }
        .btn-icon-only:hover { background: var(--bg-card-hover); color: var(--text-main); }
        .btn-link-external { color: var(--accent); border: 1px solid rgba(251, 191, 36, 0.2); background: rgba(251, 191, 36, 0.05); }
        .btn-link-external:hover { background: rgba(251, 191, 36, 0.1); color: #fff; border-color: var(--accent); }

        input, select, textarea { width: 100%; background: var(--bg-body); border: 1px solid var(--border); color: var(--text-main); padding: 0.75rem 1rem; border-radius: var(--radius-md); font-family: var(--font-main); font-size: 16px; transition: all 0.2s; }
        input:focus, textarea:focus { outline: none; border-color: var(--primary); background: var(--bg-card-hover); }

        /* AUTH STYLES */
        .auth-container { width: 100%; max-width: 400px; text-align: center; padding: 2.5rem !important; border: 1px solid var(--border); box-shadow: 0 20px 50px -10px rgba(0,0,0,0.5); }
        @media (max-width: 480px) { .auth-container { padding: 1.5rem !important; width: 95%; border-radius: 20px; margin-top: 4rem; } }

        .auth-tabs { display: flex; margin-bottom: 2rem; background: var(--bg-body); padding: 4px; border-radius: 50px; border: 1px solid var(--border); position: relative; overflow: hidden; }
        .auth-tab { flex: 1; padding: 10px; border-radius: 40px; cursor: pointer; font-weight: 600; color: var(--text-muted); transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); z-index: 2; position: relative; }
        .auth-tab.active { color: white; }
        .tab-slider { position: absolute; top: 4px; left: 4px; width: calc(50% - 4px); height: calc(100% - 8px); background: var(--primary); border-radius: 40px; transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); z-index: 1; }
        .auth-tabs.signup-active .tab-slider { transform: translateX(100%); }

        .input-group { position: relative; margin-bottom: 1.2rem; text-align: left; }
        .input-group label { font-size: 0.8rem; color: var(--text-muted); margin-bottom: 0.4rem; display: block; font-weight: 500; margin-left: 5px; }
        .input-group input { padding-left: 40px; }
        .input-icon { position: absolute; left: 12px; top: 38px; color: var(--text-muted); transition: color 0.2s; }
        .password-toggle { position: absolute; right: 12px; top: 38px; cursor: pointer; color: var(--text-muted); z-index: 10; }

        .auth-btn-submit { width: 100%; padding: 1rem; border-radius: 12px; background: linear-gradient(135deg, var(--primary), var(--primary-hover)); color: white; font-weight: 600; border: none; cursor: pointer; font-size: 1rem; margin-top: 0.5rem; transition: transform 0.2s; }
        .auth-bottom-link { margin-top: 1.5rem; font-size: 0.85rem; color: var(--text-muted); border-top: 1px solid var(--border); padding-top: 1rem; }
        .auth-bottom-link a { color: var(--accent); text-decoration: none; font-weight: 600; cursor: pointer; }

        /* Toast */
        #toast-container { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 9999; display: flex; flex-direction: column; gap: 10px; width: 90%; max-width: 400px; pointer-events: none; }
        .toast { background: var(--bg-card); color: var(--text-main); padding: 12px 20px; border-radius: 50px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); border: 1px solid var(--border); display: flex; align-items: center; gap: 12px; animation: slideDown 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); pointer-events: auto; }
        .toast.error { border-color: var(--danger); }
        .toast.success { border-color: var(--success); }
        @keyframes slideDown { from { transform: translateY(-50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        /* XP & Level */
        .level-container { background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius-lg); padding: 1.5rem; margin-bottom: 1.5rem; position: relative; overflow: hidden; }
        .level-circle-container { display: flex; justify-content: center; align-items: center; margin-bottom: 1rem; }
        .level-circle { position: relative; width: 120px; height: 120px; display: flex; align-items: center; justify-content: center; }
        .level-circle svg { width: 100%; height: 100%; transform: rotate(-90deg); }
        .level-circle circle { fill: none; stroke-width: 8; stroke-linecap: round; }
        .level-circle-bg { stroke: rgba(255,255,255,0.1); }
        .level-circle-fg { stroke: var(--accent); stroke-dasharray: 314; stroke-dashoffset: 314; transition: stroke-dashoffset 1s ease; }
        .level-circle-content { position: absolute; text-align: center; }
        .level-number-large { font-size: 2.2rem; font-weight: 700; color: white; line-height: 1; }
        .level-label-small { font-size: 0.75rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; }
        @keyframes floatUpFade { 0% { opacity:1; transform:translateY(0) scale(1); } 100% { opacity:0; transform:translateY(-50px) scale(1.2); } }
        .floating-xp { position: fixed; color: var(--accent); font-weight: bold; font-size: 1.2rem; pointer-events: none; z-index: 9999; animation: floatUpFade 1.5s forwards; text-shadow: 0 2px 10px rgba(0,0,0,0.5); }

        /* Grids */
        .settings-grid { display: flex; flex-wrap: wrap; gap: 10px; }
        .settings-grid .btn { flex: 1 1 auto; }
        .grid-dashboard { display: grid; grid-template-columns: 1.3fr 0.7fr; gap: 1.5rem; }
        .grid-profile { display: grid; grid-template-columns: 320px 1fr; gap: 1.5rem; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; }

        /* Features */
        .priority-item { display: flex; align-items: center; gap: 1rem; padding: 1rem; background: var(--bg-body); border: 1px solid var(--border); border-radius: var(--radius-md); transition: all 0.2s; cursor: pointer; margin-bottom: 0.75rem; }
        .priority-item.checked .priority-text { text-decoration: line-through; color: var(--text-muted); }
        .priority-checkbox { width: 24px; height: 24px; border-radius: 50%; border: 2px solid var(--text-muted); display: flex; align-items: center; justify-content: center; color: transparent; }
        .priority-item.checked .priority-checkbox { background: var(--success); border-color: var(--success); color: white; }

        .graph-container { display: flex; justify-content: space-between; align-items: flex-end; height: 180px; padding: 20px 10px 5px 10px; background: linear-gradient(to bottom, rgba(30,41,59,0.3), rgba(15,23,42,0.3)); border-radius: 12px; border: 1px solid rgba(255,255,255,0.05); }
        .graph-col { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 8px; height: 100%; justify-content: flex-end; }
        .graph-bar { width: 10px; background: linear-gradient(180deg, var(--primary) 0%, var(--primary-hover) 100%); border-radius: 20px; transition: height 0.8s; min-height: 4px; }
        .graph-label { font-size: 0.65rem; color: var(--text-muted); }

        .cal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; font-size: 0.9rem; font-weight: 700; }
        .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; }
        .cal-day { aspect-ratio: 1; display: flex; align-items: center; justify-content: center; border-radius: 6px; font-size: 0.8rem; cursor: pointer; border: 1px solid transparent; position: relative; }
        .cal-day.today { color: var(--accent); font-weight: bold; border-color: var(--accent); }
        .cal-day.has-data .cal-dot { width: 4px; height: 4px; border-radius: 50%; background: var(--success); position: absolute; bottom: 4px; }

        .courses-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(340px, 1fr)); gap: 1.5rem; }
        .course-filter-container { display: flex; gap: 10px; margin-bottom: 1.5rem; border-bottom: 1px solid var(--border); padding-bottom: 1rem; }
        .course-tab { background: none; border: none; color: var(--text-muted); font-weight: 600; font-size: 0.95rem; cursor: pointer; padding: 0.5rem 1rem; border-radius: 20px; transition: all 0.2s; }
        .course-tab.active { background: var(--bg-card-hover); color: var(--text-main); }
        
        .course-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius-lg); overflow: hidden; transition: all 0.3s ease; display: flex; flex-direction: column; position: relative; }
        .course-header { padding: 1.5rem; background: linear-gradient(to bottom right, rgba(30,41,59,1), rgba(15,23,42,1)); border-bottom: 1px solid var(--border); position: relative; cursor: pointer; }
        .course-header-top { display: flex; justify-content: space-between; align-items: flex-start; gap: 1rem; margin-bottom: 0.5rem; }
        .course-badge { font-size: 0.7rem; padding: 0.25rem 0.75rem; border-radius: 20px; background: rgba(99, 102, 241, 0.1); color: var(--primary); border: 1px solid rgba(99, 102, 241, 0.2); font-weight: 600; text-transform: uppercase; }
        .course-title { font-family: var(--font-heading); font-size: 1.15rem; font-weight: 600; line-height: 1.4; display: flex; align-items: center; gap: 8px; flex: 1; }
        .course-title i { font-size: 0.9rem; opacity: 0.5; transition: transform 0.3s; margin-top: 3px; }
        .video-accordion.open ~ .course-header .course-title i { transform: rotate(180deg); color: var(--primary); opacity: 1; }
        .course-meta { font-size: 0.85rem; color: var(--text-muted); display: flex; gap: 1rem; margin-top: 0.5rem; }
        .course-progress-area { padding: 1rem 1.5rem; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .progress-text { display: flex; justify-content: space-between; font-size: 0.8rem; color: var(--text-muted); font-weight: 500; margin-top: 5px; }
        .video-accordion { max-height: 0; overflow: hidden; transition: max-height 0.4s ease; background: var(--bg-card); }
        .video-accordion.open { max-height: 400px; overflow-y: auto; }
        .course-actions-container { position: absolute; bottom: 15px; right: 15px; z-index: 5; display: flex; gap: 8px; }
        .course-edit-btn { background: var(--bg-card-hover); color: var(--text-muted); border: 1px solid var(--border); width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.2s; }

        .ach-filters { display: flex; gap: 10px; margin-bottom: 1.5rem; overflow-x: auto; white-space: nowrap; padding-bottom: 5px; }
        .ach-filter-btn { padding: 0.4rem 1rem; border-radius: 20px; border: 1px solid var(--border); background: var(--bg-body); color: var(--text-muted); cursor: pointer; font-size: 0.85rem; }
        .ach-filter-btn.active { background: var(--primary); color: white; border-color: var(--primary); }
        .achievements-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 1rem; }
        .ach-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius-lg); padding: 1.25rem; display: flex; gap: 1rem; align-items: center; opacity: 0.5; filter: grayscale(1); transition: all 0.3s; position: relative; }
        .ach-card.earned { opacity: 1; filter: grayscale(0); border-color: var(--accent); background: linear-gradient(135deg, var(--bg-card), rgba(251, 191, 36, 0.05)); transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .ach-icon { font-size: 1.8rem; color: var(--text-muted); min-width: 50px; text-align: center; }
        .ach-card.earned .ach-icon { color: var(--accent); text-shadow: 0 0 10px rgba(251,191,36,0.4); }
        .ach-info h4 { font-size: 0.95rem; margin-bottom: 2px; }
        .ach-info p { font-size: 0.75rem; color: var(--text-muted); }
        .ach-progress { height: 4px; background: rgba(255,255,255,0.1); margin-top: 8px; border-radius: 2px; overflow: hidden; }
        .ach-fill { height: 100%; background: var(--primary); width: 0%; }

        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(15, 23, 42, 0.9); backdrop-filter: blur(5px); display: none; align-items: center; justify-content: center; z-index: 1000; }
        .modal-overlay.active { display: flex; animation: fadeIn 0.2s; }
        .modal-box { background: var(--bg-card); width: 90%; max-width: 600px; border-radius: var(--radius-lg); border: 1px solid var(--border); padding: 2rem; max-height: 90vh; overflow-y: auto; position: relative; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        @media (max-width: 768px) {
            .sidebar { transform: translateX(-100%); }
            .main-content { margin-left: 0; padding: 1.25rem; padding-bottom: 100px; }
            .mobile-nav { display: flex; }
            .grid-dashboard, .grid-profile, .grid-2, .courses-grid { grid-template-columns: 1fr; }
            .page-header { flex-direction: row; }
            .greeting h1 { font-size: 1.2rem; }
            .settings-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
            .settings-grid .btn { width: 100%; margin: 0; padding: 0.8rem 0.5rem; font-size: 0.85rem; flex-direction: column; gap: 5px; text-align: center; }
        }
    </style>
</head>
<body>
    <div id="toast-container"></div>

    <div id="auth-overlay" class="modal-overlay">
        <div class="modal-box auth-container">
            <button class="btn-icon-only" onclick="document.getElementById('auth-overlay').classList.remove('active')" style="position:absolute; top:15px; right:15px;">‚úï</button>
            <h2 style="margin-bottom: 0.5rem; color: var(--primary); font-family: var(--font-heading);">Welcome Back</h2>
            <div class="auth-tabs" id="authTabsContainer">
                <div class="tab-slider"></div>
                <div class="auth-tab active" id="tab-login" onclick="toggleAuthMode('login')">Login</div>
                <div class="auth-tab" id="tab-signup" onclick="toggleAuthMode('signup')">Create Account</div>
            </div>
            <form id="auth-form" onsubmit="handleAuth(event)" novalidate>
                <div class="input-group">
                    <label>Email Address</label>
                    <input type="email" id="auth-email" placeholder="student@college.edu" required>
                    <i class="fas fa-envelope input-icon"></i>
                </div>
                <div class="input-group">
                    <label>Password</label>
                    <div class="password-wrapper">
                        <input type="password" id="auth-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                        <i class="fas fa-lock input-icon"></i>
                        <i class="fas fa-eye password-toggle" id="togglePassword" onclick="window.togglePasswordVisibility()"></i>
                    </div>
                </div>
                <button type="submit" class="auth-btn-submit" id="auth-btn">Login</button>
            </form>
        </div>
    </div>

    <div id="addPlaylistModal" class="modal-overlay">
        <div class="modal-box">
            <div class="card-title">
                <div class="card-title-group"><i class="fas fa-plus"></i> Add New Course</div>
                <button class="btn-icon-only" onclick="closeModal('addPlaylistModal')">‚úï</button>
            </div>
            <form id="addCourseForm" onsubmit="savePlaylist(event)">
                <div class="input-group">
                    <label>Course Name</label>
                    <input type="text" id="plName" required placeholder="e.g., Machine Learning A-Z">
                </div>
                <div class="input-group">
                    <label>Source (Platform)</label>
                    <select id="plSource">
                        <option value="Udemy">Udemy</option>
                        <option value="YouTube">YouTube</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Course Link (Optional)</label>
                    <input type="url" id="plLink" placeholder="https://...">
                </div>
                <div class="input-group">
                    <label>Video Titles (One per line)</label>
                    <textarea id="plVideos" rows="5" placeholder="Intro to Python&#10;Setup Environment"></textarea>
                </div>
                <button type="submit" class="btn btn-primary" style="width:100%">Create Course</button>
            </form>
        </div>
    </div>

    <div id="manageGoalsModal" class="modal-overlay">
        <div class="modal-box">
            <div class="card-title">
                <div class="card-title-group"><i class="fas fa-tasks"></i> Manage Today's Goals</div>
                <button class="btn-icon-only" onclick="closeModal('manageGoalsModal')">‚úï</button>
            </div>
            <div style="display: flex; gap: 10px; margin-bottom: 1.5rem;">
                <input type="text" id="newGoalInput" placeholder="Add a new task...">
                <button class="btn btn-primary" onclick="addGoal()">Add</button>
            </div>
            <div id="manageGoalsList"></div>
        </div>
    </div>

    <nav class="mobile-nav">
        <div class="mobile-nav-item active" id="mob-dashboard" onclick="switchTab('dashboard')"><i class="fas fa-home"></i><span>Home</span></div>
        <div class="mobile-nav-item" id="mob-courses" onclick="switchTab('courses')"><i class="fas fa-book"></i><span>Courses</span></div>
        <div class="mobile-nav-item" id="mob-focus" onclick="switchTab('focus')"><i class="fas fa-clock"></i><span>Focus</span></div>
        <div class="mobile-nav-item" id="mob-achievements" onclick="switchTab('achievements')"><i class="fas fa-trophy"></i><span>Awards</span></div>
        <div class="mobile-nav-item" id="mob-profile" onclick="switchTab('profile')"><i class="fas fa-user"></i><span>Profile</span></div>
    </nav>

    <div class="app-wrapper">
        <aside class="sidebar">
            <div class="brand"><i class="fas fa-graduation-cap"></i><span>Achieve-mate</span></div>
            <div class="nav-item active" id="nav-dashboard" onclick="switchTab('dashboard')"><i class="fas fa-chart-pie"></i> Dashboard</div>
            <div class="nav-item" id="nav-courses" onclick="switchTab('courses')"><i class="fas fa-play-circle"></i> My Courses</div>
            <div class="nav-item" id="nav-focus" onclick="switchTab('focus')"><i class="fas fa-stopwatch"></i> Focus Mode</div>
            <div class="nav-item" id="nav-achievements" onclick="switchTab('achievements')"><i class="fas fa-trophy"></i> Achievements</div>
            <div class="nav-item" id="nav-profile" onclick="switchTab('profile')"><i class="fas fa-user-circle"></i> Profile</div>
        </aside>

        <main class="main-content">
            <header class="page-header">
                <div class="header-left">
                    <div class="greeting">
                        <h1 id="greetingText">Good Morning!</h1>
                        <p id="dateDisplay" style="color:var(--text-muted); font-size:0.9rem;">Loading...</p>
                    </div>
                </div>
                <div class="header-right">
                    <button id="headerLoginBtn" class="header-login-btn" onclick="document.getElementById('auth-overlay').classList.add('active')">
                        <i class="fas fa-sign-in-alt"></i> Login
                    </button>
                    <div id="headerUserBadge" class="user-badge-header" onclick="switchTab('profile')">
                        <div class="user-badge-avatar" id="headerUserInitials">U</div>
                        <div class="user-badge-name" id="headerUserName">User</div>
                    </div>
                    <div class="streak-badge" onclick="switchTab('profile')">
                        <i class="fas fa-fire" style="color: var(--accent)"></i>
                        <div class="streak-count" id="headerStreak">0</div>
                    </div>
                </div>
            </header>

            <div id="dashboard-view" class="view-section">
                <div class="grid-dashboard">
                    <div style="display: flex; flex-direction: column; gap: 1.5rem;">
                        <div class="card" style="background: var(--bg-card); border: 1px solid var(--primary); color: white;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="font-size: 0.8rem; opacity: 0.9; text-transform: uppercase; letter-spacing: 1px; color: var(--primary);">Current Level</div>
                                    <div style="font-size: 2rem; font-weight: 700; font-family: var(--font-heading);" id="dashboardLevelDisplay">1</div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="font-size: 0.9rem; font-weight: 600;" id="dashboardXPDisplay">0 XP</div>
                                </div>
                            </div>
                            <div style="height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; margin-top: 10px; overflow: hidden;">
                                <div id="dashboardLevelBar" style="height: 100%; background: var(--primary); width: 0%; transition: width 1s ease;"></div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-title">
                                <div class="card-title-group"><i class="fas fa-tasks"></i> Today's Priority</div>
                                <button class="btn-icon-only" onclick="openModal('manageGoalsModal')"><i class="fas fa-pencil-alt"></i></button>
                            </div>
                            <div id="dashboardGoalsList"></div>
                            <div id="emptyGoalsMsg" style="text-align:center; color:var(--text-muted); padding:1rem; font-size:0.9rem; display:none;">No tasks set. Tap the pencil to add.</div>
                        </div>
                    </div>
                    
                    <div style="display: flex; flex-direction: column; gap: 1.5rem;">
                        <div class="card">
                            <div class="card-title"><div class="card-title-group"><i class="fas fa-chart-line"></i> Progress</div></div>
                            <div style="display: flex; justify-content: space-around; text-align: center; padding: 10px 0;">
                                <div style="cursor: pointer;" onclick="switchTab('courses')">
                                    <div style="font-size: 2rem; font-weight: 700; color: var(--accent);" id="topicPct">0%</div>
                                    <div style="font-size: 0.9rem; color: var(--text-muted);">Courses</div>
                                </div>
                                <div style="cursor: pointer;" onclick="openModal('manageGoalsModal')">
                                    <div style="font-size: 2rem; font-weight: 700; color: var(--accent);" id="goalPct">0%</div>
                                    <div style="font-size: 0.9rem; color: var(--text-muted);">Goals</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="courses-view" class="view-section" style="display: none;">
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h2 style="font-family: var(--font-heading);">Learning Playlists</h2>
                        <button class="btn btn-primary" onclick="openModal('addPlaylistModal')"><i class="fas fa-plus"></i> Add Course</button>
                    </div>
                    
                    <div class="course-filter-container">
                        <button class="course-tab active" onclick="filterCourses('all', this)">All</button>
                        <button class="course-tab" onclick="filterCourses('active', this)">In Progress</button>
                        <button class="course-tab" onclick="filterCourses('completed', this)">Completed</button>
                    </div>
                    <div id="playlistsContainer" class="courses-grid"></div>
                </div>
            </div>

            <div id="focus-view" class="view-section" style="display: none;">
                 <div id="focus-overlay" class="modal-overlay" style="background: #0f172a; z-index: 2000;">
                    <div style="text-align: center;">
                        <div style="font-size: 1.5rem; color: var(--text-muted); margin-bottom: 1rem;">Focusing on</div>
                        <h1 id="overlayTask" style="font-size: 2.5rem; margin-bottom: 3rem; font-family: var(--font-heading);">Deep Work</h1>
                        <div id="overlayTimer" style="font-size: 6rem; font-weight: 700; font-variant-numeric: tabular-nums; color: var(--primary); margin-bottom: 3rem;">25:00</div>
                        <button class="btn btn-danger" onclick="stopFullScreenFocus()" style="padding: 1rem 3rem; font-size: 1.2rem; border-radius: 50px;">Stop Session</button>
                    </div>
                </div>
                <div class="grid-2">
                    <div class="card">
                        <div class="card-title" style="justify-content: center;">Focus Session</div>
                        <input type="text" id="focusTaskInput" placeholder="What are you working on?" style="text-align: center; margin-bottom: 1.5rem;">
                        <label style="display:block; text-align:center; color:var(--text-muted); margin-bottom:0.5rem;">Duration (Minutes)</label>
                        <input type="number" id="customFocusTime" value="25" style="text-align:center; margin-bottom:1rem; width:80px; margin-left:auto; margin-right:auto; display:block;">
                        <button class="btn btn-primary" style="width:100%" onclick="startFullScreenFocus()">Start Focus</button>
                    </div>
                </div>
            </div>

            <div id="achievements-view" class="view-section" style="display: none;">
                <div class="card">
                    <div class="card-title">
                        <div class="card-title-group">Badges & Milestones</div>
                        <span id="badgeCount" style="color:var(--accent)">0 / 17</span>
                    </div>
                    <div class="achievements-grid" id="achievementsGrid"></div>
                </div>
            </div>

            <div id="profile-view" class="view-section" style="display: none;">
                <div class="card" style="display:flex; align-items:center; gap:1.5rem;">
                    <div style="width:70px; height:70px; border-radius:50%; background:var(--primary); color:white; display:flex; align-items:center; justify-content:center; font-size:2rem; font-weight:700;" id="profilePic">U</div>
                    <div>
                        <h2 id="profileName">Guest User</h2>
                        <p id="profileEmail" style="color:var(--text-muted); font-size:0.9rem;">Not logged in</p>
                    </div>
                </div>
                <div class="card">
                    <div class="settings-grid">
                        <button class="btn btn-secondary" onclick="if(confirm('Clear data?')) { localStorage.clear(); location.reload(); }">Reset App</button>
                        <button class="btn btn-danger" id="logoutBtn" style="display:none;" onclick="window.logoutUser()">Logout</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBBuXEgTrEbAkj-BN_VSSYoVDx5e51fw4A",
            authDomain: "achieve-mate.firebaseapp.com",
            projectId: "achieve-mate",
            storageBucket: "achieve-mate.firebasestorage.app",
            messagingSenderId: "209711943902",
            appId: "1:209711943902:web:e8df445f14cc5c9b6eb24f"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        window.handleAuth = async (e) => {
            e.preventDefault();
            const email = document.getElementById('auth-email').value;
            const pass = document.getElementById('auth-password').value;
            const isSignup = document.getElementById('tab-signup').classList.contains('active');
            const btn = document.getElementById('auth-btn');
            btn.textContent = "Processing...";

            try {
                if (isSignup) {
                    await createUserWithEmailAndPassword(auth, email, pass);
                    alert("Account created! Please login.");
                    window.toggleAuthMode('login');
                } else {
                    await signInWithEmailAndPassword(auth, email, pass);
                    document.getElementById('auth-overlay').classList.remove('active');
                    alert("Logged in successfully!");
                }
            } catch (err) {
                // CRITICAL FIX: Show exact error
                alert("Login Failed: " + err.message);
                console.error(err);
            } finally {
                btn.textContent = isSignup ? "Create Account" : "Login";
            }
        };

        window.logoutUser = () => signOut(auth).then(() => location.reload());

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                const docRef = doc(db, "users", user.uid);
                const docSnap = await getDoc(docRef);
                if (docSnap.exists()) {
                    window.appData = docSnap.data();
                    window.refreshUI(); // Ensure UI updates on login
                }
                updateUserUI(user);
            } else {
                resetUserUI();
            }
        });

        function updateUserUI(user) {
            const name = user.email.split('@')[0];
            document.getElementById('profileName').textContent = name;
            document.getElementById('profileEmail').textContent = user.email;
            document.getElementById('profilePic').textContent = name[0].toUpperCase();
            document.getElementById('headerLoginBtn').style.display = 'none';
            document.getElementById('headerUserBadge').style.display = 'flex';
            document.getElementById('headerUserInitials').textContent = name[0].toUpperCase();
            document.getElementById('logoutBtn').style.display = 'inline-flex';
        }

        function resetUserUI() {
            document.getElementById('headerLoginBtn').style.display = 'flex';
            document.getElementById('headerUserBadge').style.display = 'none';
            document.getElementById('logoutBtn').style.display = 'none';
        }

        window.saveCloudData = async () => {
            if (auth.currentUser && window.appData) {
                await setDoc(doc(db, "users", auth.currentUser.uid), window.appData);
            }
        };
    </script>

    <script>
        window.appData = { playlists: [], dailyGoals: [], streak: 0, xp: 0, level: 1, history: {} };
        let currentCourseFilter = 'all';
        let currentBadgeFilter = 'all';

        function init() {
            const local = localStorage.getItem('achieveMate_v12');
            if(local) window.appData = JSON.parse(local);
            updateGreeting();
            refreshUI();
            switchTab('dashboard');
        }

        // --- CENTRALIZED REFRESH TO FIX RENDERING BUGS ---
        window.refreshUI = function() {
            renderGoals();
            renderPlaylists();
            renderAchievements();
            updateXP();
            document.getElementById('headerStreak').textContent = window.appData.streak;
        }

        window.saveData = function() {
            localStorage.setItem('achieveMate_v12', JSON.stringify(window.appData));
            if(window.saveCloudData) window.saveCloudData();
        }

        // --- GOALS ---
        window.addGoal = function() {
            const txt = document.getElementById('newGoalInput').value;
            if(!txt) return;
            window.appData.dailyGoals.push({ id: Date.now(), text: txt, done: false, date: new Date().toDateString() });
            document.getElementById('newGoalInput').value = '';
            window.saveData();
            window.refreshUI(); // FIX: Immediate Render
        }

        window.toggleGoal = function(id) {
            const g = window.appData.dailyGoals.find(x => x.id === id);
            if(g) {
                g.done = !g.done;
                if(g.done) { window.appData.streak++; addXP(20); }
                else { addXP(-20); }
                window.saveData();
                window.refreshUI(); // FIX: Immediate Render
            }
        }

        function renderGoals() {
            const list = document.getElementById('dashboardGoalsList');
            const goals = window.appData.dailyGoals.filter(g => g.date === new Date().toDateString());
            if(list) {
                list.innerHTML = goals.length ? goals.map(g => `
                    <div class="priority-item ${g.done?'checked':''}" onclick="toggleGoal(${g.id})">
                        <div class="priority-checkbox">${g.done?'‚úì':''}</div>
                        <div>${g.text}</div>
                    </div>`).join('') : '<div style="text-align:center; color:#888;">No goals today</div>';
            }
        }

        // --- COURSES ---
        window.savePlaylist = function(e) {
            if(e) e.preventDefault();
            const name = document.getElementById('plName').value;
            const videos = document.getElementById('plVideos').value.split('\n').filter(v=>v.trim()).map(v=>({id:Date.now()+Math.random(), title:v, done:false}));
            
            window.appData.playlists.push({ 
                id: Date.now(), name: name, source: document.getElementById('plSource').value, videos: videos, link: document.getElementById('plLink').value 
            });
            
            window.closeModal('addPlaylistModal');
            window.saveData();
            currentCourseFilter = 'all'; // Reset filter so new course shows
            window.refreshUI(); // FIX: Immediate Render
        }

        window.toggleVideo = function(plId, vId) {
            const pl = window.appData.playlists.find(p=>p.id===plId);
            const v = pl.videos.find(x=>x.id===vId);
            if(v) {
                v.done = !v.done;
                if(v.done) { addXP(50); triggerConfetti(); }
                else { addXP(-50); }
                window.saveData();
                window.refreshUI(); // FIX: Immediate Render
            }
        }

        window.filterCourses = function(filter, btn) {
            currentCourseFilter = filter;
            document.querySelectorAll('.course-tab').forEach(b => b.classList.remove('active'));
            if(btn) btn.classList.add('active');
            renderPlaylists();
        }

        window.toggleAccordion = function(id) {
            const el = document.getElementById('acc-'+id);
            if(el) {
                el.classList.toggle('open');
                // Rotate icon
                const icon = document.getElementById('icon-'+id);
                if(icon) icon.style.transform = el.classList.contains('open') ? 'rotate(180deg)' : 'rotate(0deg)';
            }
        }

        function renderPlaylists() {
            const div = document.getElementById('playlistsContainer');
            if(!div) return;
            div.innerHTML = '';
            let list = window.appData.playlists;
            if(currentCourseFilter === 'active') list = list.filter(p => p.videos.some(v=>!v.done));
            if(currentCourseFilter === 'completed') list = list.filter(p => p.videos.every(v=>v.done));

            if(list.length === 0) { div.innerHTML = '<div style="color:#888; text-align:center;">No courses found.</div>'; return; }

            list.forEach(pl => {
                const done = pl.videos.filter(v=>v.done).length;
                const total = pl.videos.length;
                const pct = total ? Math.round((done/total)*100) : 0;
                div.innerHTML += `
                    <div class="course-card">
                        <div class="course-header" onclick="toggleAccordion(${pl.id})">
                            <div class="course-header-top">
                                <div class="course-title"><i id="icon-${pl.id}" class="fas fa-chevron-down" style="transition:transform 0.3s;"></i> ${pl.name}</div>
                                <div class="course-badge">${pl.source}</div>
                            </div>
                            <div class="course-meta">${done}/${total} Completed</div>
                        </div>
                        <div class="course-progress-area">
                            <div style="height:6px; background:var(--bg-body); border-radius:3px; overflow:hidden;"><div style="height:100%; background:var(--success); width:${pct}%"></div></div>
                        </div>
                        <div class="video-accordion" id="acc-${pl.id}">
                            ${pl.videos.map(v => `
                                <div class="priority-item ${v.done?'checked':''}" onclick="toggleVideo(${pl.id}, ${v.id})">
                                    <div class="priority-checkbox">${v.done?'‚úì':''}</div>
                                    <div>${v.title}</div>
                                </div>`).join('')}
                        </div>
                    </div>`;
            });
        }

        // --- XP & BADGES ---
        function addXP(amount) {
            window.appData.xp = (window.appData.xp || 0) + amount;
            if(window.appData.xp < 0) window.appData.xp = 0;
            window.appData.level = Math.floor(window.appData.xp / 500) + 1;
        }

        function updateXP() {
            const xp = window.appData.xp || 0;
            const level = window.appData.level || 1;
            document.getElementById('dashboardLevelDisplay').textContent = level;
            document.getElementById('dashboardXPDisplay').textContent = xp + ' XP';
            const progress = ((xp - (level-1)*500) / 500) * 100;
            document.getElementById('dashboardLevelBar').style.width = Math.max(0, Math.min(100, progress)) + '%';
        }

        const BADGES = [
            { n: 'Starter', t: 1, c: d => d.streak, cat: 'streak' },
            { n: 'Week Warrior', t: 7, c: d => d.streak, cat: 'streak' },
            { n: 'Scholar', t: 1, c: d => d.playlists.length, cat: 'playlist' }
        ];

        function renderAchievements() {
            const grid = document.getElementById('achievementsGrid');
            if(!grid) return;
            grid.innerHTML = BADGES.map(b => {
                const val = b.c(window.appData);
                const earned = val >= b.t;
                return `<div class="ach-card ${earned?'earned':''}">
                            <div style="font-size:1.5rem;">üèÜ</div>
                            <div>${b.n}</div>
                            <div style="font-size:0.8rem; color:#888;">${earned ? 'Unlocked' : 'Locked'}</div>
                        </div>`;
            }).join('');
            const earned = BADGES.filter(b => b.c(window.appData) >= b.t).length;
            document.getElementById('badgeCount').textContent = `${earned} / ${BADGES.length}`;
        }

        // --- NAVIGATION & UTILS ---
        window.switchTab = function(id) {
            document.querySelectorAll('.view-section').forEach(e => e.style.display = 'none');
            document.getElementById(id + '-view').style.display = 'block';
            document.querySelectorAll('.nav-item, .mobile-nav-item').forEach(e => e.classList.remove('active'));
            if(document.getElementById('nav-'+id)) document.getElementById('nav-'+id).classList.add('active');
            if(document.getElementById('mob-'+id)) document.getElementById('mob-'+id).classList.add('active');
            window.refreshUI(); // FIX: Render on switch
        }

        window.openModal = function(id) { document.getElementById(id).classList.add('active'); }
        window.closeModal = function(id) { document.getElementById(id).classList.remove('active'); }

        window.toggleAuthMode = function(mode) {
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            document.getElementById('tab-'+mode).classList.add('active');
            document.getElementById('auth-btn').textContent = mode==='login'?'Login':'Create Account';
        }

        window.togglePasswordVisibility = function() {
            const input = document.getElementById('auth-password');
            input.type = input.type === "password" ? "text" : "password";
        }

        function updateGreeting() {
            document.getElementById('dateDisplay').textContent = new Date().toDateString();
        }

        // SAFETY FIX: Confetti simplified for build
        function triggerConfetti() { console.log("Confetti!"); }

        // Focus Mode Stubs (to prevent crashes)
        let focusInterval;
        window.startFullScreenFocus = function() {
            document.getElementById('focus-overlay').classList.add('active');
            let mins = document.getElementById('customFocusTime').value || 25;
            let secs = mins * 60;
            focusInterval = setInterval(() => {
                secs--;
                if(secs <= 0) { clearInterval(focusInterval); alert("Focus Complete!"); addXP(mins*5); window.stopFullScreenFocus(); }
                document.getElementById('overlayTimer').textContent = Math.floor(secs/60) + ":" + (secs%60).toString().padStart(2,'0');
            }, 1000);
        }
        window.stopFullScreenFocus = function() {
            clearInterval(focusInterval);
            document.getElementById('focus-overlay').classList.remove('active');
            window.refreshUI();
        }

        init();
    </script>
</body>
</html>